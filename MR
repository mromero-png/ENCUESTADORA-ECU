html_code_content = """
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Votación</title>
    <style>
        /* Estilos Generales */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7f6;
            color: #333;
        }

        header {
            background-color: #2c3e50;
            color: #ffffff;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        main {
            padding: 20px;
            max-width: 1200px;
            margin: 20px auto;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        /* Estilos para Contenedor de Tarjetas de Candidatos */
        #candidate-cards-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
        }

        .candidate-card {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            width: 280px; /* Ancho fijo para las tarjetas */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s ease-in-out;
            position: relative; /* Para el radio button flotante */
        }

        .candidate-card:hover {
            transform: translateY(-5px);
        }

        .candidate-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 3px solid #3498db;
        }

        .candidate-name {
            font-size: 1.4em;
            color: #34495e;
            margin: 10px 0;
        }

        .vote-count {
            font-size: 1.1em;
            color: #7f8c8d;
            margin-bottom: 15px;
        }

        /* Estilos para el Formulario de Votación */
        #voting-form-section {
            background-color: #ecf0f1;
            padding: 30px;
            border-radius: 8px;
            margin-top: 40px;
        }

        #voting-form {
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input[type="text"] {
            width: calc(100% - 22px); /* Ajustar para padding y borde */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
        }

        #candidate-selection-radios {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }

        /* Estilos para los radio buttons personalizados */
        .candidate-radio-wrapper {
            position: relative;
            padding: 10px 15px;;
            border-radius: 20px;
            background-color: #e0e0e0;
            cursor: pointer;
            transition: background-color 0.2s;
            text-align: center;
        }

        .candidate-radio-wrapper:hover {
            background-color: #d0d0d0;
        }

        .candidate-radio-wrapper input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .candidate-radio-wrapper label {
            display: inline-block;
            margin: 0;
            font-weight: normal;
            color: #333;
            cursor: pointer;
        }

        .candidate-radio-wrapper input[type="radio"]:checked + label {
            font-weight: bold;
            color: #2c3e50;
        }

        .candidate-radio-wrapper input[type="radio"]:checked + label::before {
            content: '✅ ';
        }


        #vote-button {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #27ae60;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 30px;
            transition: background-color 0.2s ease;
        }

        #vote-button:hover {
            background-color: #2ecc71;
        }

        footer {
            text-align: center;
            padding: 20px;
            background-color: #2c3e50;
            color: #ffffff;
            margin-top: 40px;
        }

        /* Mensajes de feedback */
        #feedback-message {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            display: none; /* Oculto por defecto */
        }

        .feedback-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .feedback-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Estilos Responsivos */
        @media (max-width: 768px) {
            main {
                margin: 10px;
                padding: 15px;
            }

            #candidate-cards-container {
                flex-direction: column;
                align-items: center;
            }

            .candidate-card {
                width: 90%;
            }

            #voting-form {
                padding: 15px;
            }

            .form-group input[type="text"] {
                width: calc(100% - 20px);
            }

            #candidate-selection-radios {
                flex-direction: column;
                align-items: flex-start;
            }

            .candidate-radio-wrapper {
                width: 100%;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            #candidate-cards-container {
                gap: 15px;
            }

            .candidate-card {
                width: 250px;
            }
        }

    </style>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

</head>
<body>
    <header>
        <h1>Vota por tu Candidato</h1>
        <p>Elecciones 2027</p>
    </header>

    <main>
        <section id="candidates-display">
            <h2>Nuestros Candidatos</h2>
            <div id="candidate-cards-container">
                        <div class="candidate-card">
                            <img src="https://firebasestorage.googleapis.com/v0/b/planning-with-ai-3e0fa.firebasestorage.app/o/candidate_00_photo.jpg?alt=media" alt="GABRIELA RIVADENEIRA" class="candidate-photo">
                            <h4 class="candidate-name">GABRIELA RIVADENEIRA</h4>
                            <p class="vote-count">Votos: <strong>1502</strong></p>
                        </div>
                    
                        <div class="candidate-card">
                            <img src="https://firebasestorage.googleapis.com/v0/b/planning-with-ai-3e0fa.firebasestorage.app/o/candidate_02_photo.jpg?alt=media" alt="AQUILES ALVAREZ" class="candidate-photo">
                            <h4 class="candidate-name">AQUILES ALVAREZ</h4>
                            <p class="vote-count">Votos: <strong>705</strong></p>
                        </div>
                    
                        <div class="candidate-card">
                            <img src="https://firebasestorage.googleapis.com/v0/b/planning-with-ai-3e0fa.firebasestorage.app/o/candidate_01_photo.jpg?alt=media" alt="DANIEL NOBOA AZIN" class="candidate-photo">
                            <h4 class="candidate-name">DANIEL NOBOA AZIN</h4>
                            <p class="vote-count">Votos: <strong>507</strong></p>
                        </div>
                    
                        <div class="candidate-card">
                            <img src="https://firebasestorage.googleapis.com/v0/b/planning-with-ai-3e0fa.firebasestorage.app/o/candidate_03_photo.jpg?alt=media" alt="ANDREA GONZÀLES" class="candidate-photo">
                            <h4 class="candidate-name">ANDREA GONZÀLES</h4>
                            <p class="vote-count">Votos: <strong>200</strong></p>
                        </div>
                    </div>
        </section>

        <section id="voting-form-section">
            <h2>Emite tu Voto</h2>
            <form id="voting-form">
                <h3>Información del Ciudadano</h3>
                <div class="form-group">
                    <label for="cedula">Número de Cédula:</label>
                    <input type="text" id="cedula" name="cedula" required="" pattern="^[0-9]{10}$" title="Por favor, ingrese un número de cédula válido de 10 dígitos.">
                </div>
                <div class="form-group">
                    <label for="nombre">Nombre:</label>
                    <input type="text" id="nombre" name="nombre" required="">
                </div>
                <div class="form-group">
                    <label for="apellido">Apellido:</label>
                    <input type="text" id="apellido" name="apellido" required="">
                </div>

                <h3>Selecciona tu Candidato</h3>
                <div id="candidate-selection-radios">
                        <div class="candidate-radio-wrapper">
                            <input type="radio" id="radio-CANDIDATO" name="selected_candidate" value="CANDIDATO" required="">
                            <label for="radio-CANDIDATO">GABRIELA RIVADENEIRA</label>
                        </div>
                    
                        <div class="candidate-radio-wrapper">
                            <input type="radio" id="radio-CANDIDATO 2" name="selected_candidate" value="CANDIDATO 2" required="">
                            <label for="radio-CANDIDATO 2">AQUILES ALVAREZ</label>
                        </div>
                    
                        <div class="candidate-radio-wrapper">
                            <input type="radio" id="radio-CANDIDATO 1" name="selected_candidate" value="CANDIDATO 1" required="">
                            <label for="radio-CANDIDATO 1">DANIEL NOBOA AZIN</label>
                        </div>
                    
                        <div class="candidate-radio-wrapper">
                            <input type="radio" id="radio-CANDIDATO 3" name="selected_candidate" value="CANDIDATO 3" required="">
                            <label for="radio-CANDIDATO 3">ANDREA GONZÀLES</label>
                        </div>
                    </div>

                <button type="submit" id="vote-button">Votar</button>
            </form>
            <div id="feedback-message" class="feedback-success" style="display: none;"></div>
        </section>
    </main>

    <footer>
        <p>© 2026 Sistema de Votación. Todos los derechos reservados. Encuestadora MR</p>
    </footer>

    <script>
        // Tu configuración de Firebase
        const firebaseConfig = {
        apiKey: "AIzaSyAMYhvf41GNI7CDq5OE3lWNWOPn3qH_h7U",
        authDomain: "planning-with-ai-3e0fa.firebaseapp.com",
        projectId: "planning-with-ai-3e0fa",
        storageBucket: "planning-with-ai-3e0fa.firebasestorage.app",
        messagingSenderId: "182043332939",
        appId: "1:182043332939:web:e76761a36fa4655df9558ce"
      };

// Inicializar Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

        const candidateCardsContainer = document.getElementById('candidate-cards-container');
        const candidateSelectionRadios = document.getElementById('candidate-selection-radios');
        const votingForm = document.getElementById('voting-form');
        const feedbackMessage = document.getElementById('feedback-message');

        // Mapeo de IDs de candidato a números de imagen
        const candidateIdToImageIdx = {
            'CANDIDATO': 0,
            'CANDIDATO 1': 1,
            'CANDIDATO 2': 2,
            'CANDIDATO 3': 3,
        };

        async function getCandidateImageUrl(imageIndex) {
            if (imageIndex === undefined || imageIndex === null) return '';
            const filename = `candidate_${String(imageIndex).padStart(2, '0')}_photo.jpg`;
            // Construir la URL de descarga pública. Para Storage Buckets con el formato por defecto
            // gs://<bucket-name>/path/to/image.jpg, la URL http es:
            // https://firebasestorage.googleapis.com/v0/b/<bucket-name>/o/path%2Fto%2Fimage.jpg?alt=media
            // Aquí asumimos que las imágenes están en la raíz del bucket.
            const bucketName = firebaseConfig.storageBucket;
            if (!bucketName) {
                console.error("Error: storageBucket no está configurado en firebaseConfig.");
                return '';
            }
            return `https://firebasestorage.googleapis.com/v0/b/${bucketName}/o/${encodeURIComponent(filename)}?alt=media`;
        }

        async function loadCandidates() {
            candidateCardsContainer.innerHTML = '';
            candidateSelectionRadios.innerHTML = '';
            feedbackMessage.style.display = 'none';

            try {
                const candidatesRef = db.collection('candidates');
                const snapshot = await candidatesRef.get();

                if (snapshot.empty) {
                    candidateCardsContainer.innerHTML = '<p>No se encontraron candidatos.</p>';
                    return;
                }

                const candidatesData = [];
                for (const doc of snapshot.docs) {
                    const candidate = { id: doc.id, ...doc.data() };
                    candidatesData.push(candidate);
                }

                // Ordenar candidatos por votos descendente para visualización
                candidatesData.sort((a, b) => b.VOTOS - a.VOTOS);

                for (const candidate of candidatesData) {
                    const imageUrl = await getCandidateImageUrl(candidateIdToImageIdx[candidate.id]);

                    // Crear tarjeta HTML para el candidato
                    const cardHtml = `
                        <div class="candidate-card">
                            <img src="${imageUrl}" alt="${candidate.NOMBRE.trim()}" class="candidate-photo">
                            <h4 class="candidate-name">${candidate.NOMBRE.trim()}</h4>
                            <p class="vote-count">Votos: <strong>${candidate.VOTOS}</strong></p>
                        </div>
                    `;
                    candidateCardsContainer.innerHTML += cardHtml;

                    // Crear radio button para la selección
                    const radioHtml = `
                        <div class="candidate-radio-wrapper">
                            <input type="radio" id="radio-${candidate.id}" name="selected_candidate" value="${candidate.id}" required>
                            <label for="radio-${candidate.id}">${candidate.NOMBRE.trim()}</label>
                        </div>
                    `;
                    candidateSelectionRadios.innerHTML += radioHtml;
                }

            } catch (error) {
                console.error("Error al cargar candidatos: ", error);
                candidateCardsContainer.innerHTML = '<p style="color: red;">Error al cargar la información de los candidatos.</p>';
                showFeedback('Error al cargar la información de los candidatos.', 'error');
            }
        }

        function showFeedback(message, type) {
            feedbackMessage.textContent = message;
            feedbackMessage.className = 'feedback-message'; // Reset classes
            feedbackMessage.classList.add(`feedback-${type}`);
            feedbackMessage.style.display = 'block';
        }

        async function handleVoteSubmission(event) {
            event.preventDefault(); // Prevenir el envío por defecto del formulario

            const cedula = document.getElementById('cedula').value.trim();
            const nombre = document.getElementById('nombre').value.trim();
            const apellido = document.getElementById('apellido').value.trim();
            const selectedCandidateRadio = document.querySelector('input[name="selected_candidate"]:checked');

            if (!cedula || !nombre || !apellido || !selectedCandidateRadio) {
                showFeedback('Por favor, complete todos los campos y seleccione un candidato.', 'error');
                return;
            }

            const candidateId = selectedCandidateRadio.value;

            try {
                await db.runTransaction(async (transaction) => {
                    const citizenRef = db.collection('citizens').doc(cedula);
                    const citizenDoc = await transaction.get(citizenRef);

                    // LEER todos los documentos primero
                    const candidateRef = db.collection('candidates').doc(candidateId);
                    const candidateDoc = await transaction.get(candidateRef);

                    if (!candidateDoc.exists) {
                        throw new Error(`El candidato con ID ${candidateId} no existe.`);
                    }

                    if (citizenDoc.exists && citizenDoc.data().has_voted) {
                        // Ciudadano ya votó, abortar transacción
                        throw new Error(`El ciudadano con Cédula ${cedula} ya ha votado.`);
                    }

                    // Ahora que todas las lecturas se han realizado y las validaciones están hechas, procedemos con las escrituras
                    if (!citizenDoc.exists) {
                        // Ciudadano no existe, lo creamos
                        transaction.set(citizenRef, {
                            nombres: nombre,
                            apellidos: apellido,
                            has_voted: true // Marcar como votado al crearlo y votar
                        });
                        console.log(`Ciudadano ${cedula} creado y votó.`);
                    } else {
                        // Ciudadano existe y no ha votado, simplemente lo marcamos como votado
                        transaction.update(citizenRef, { has_voted: true });
                        console.log(`Ciudadano ${cedula} marcado como 'ha votado'.`);
                    }

                    // Incrementa el contador de votos del candidato
                    const newVotes = candidateDoc.data().VOTOS + 1;
                    transaction.update(candidateRef, { VOTOS: newVotes });

                    console.log(`Voto registrado para ${cedula} por ${candidateId}.`);
                });

                showFeedback('¡Voto registrado exitosamente!', 'success');
                votingForm.reset(); // Limpiar formulario después del voto
                loadCandidates(); // Recargar candidatos para mostrar el recuento actualizado

            } catch (error) {
                console.error("Error durante la transacción de voto: ", error.message);
                showFeedback(`Error al registrar el voto: ${error.message}`, 'error');
            }
        }

        // Cargar candidatos al cargar la página
        window.addEventListener('load', loadCandidates);

        // Vincular la función de envío de voto al formulario
        votingForm.addEventListener('submit', handleVoteSubmission);
    </script>


</body></html>
"""

print("HTML content for index.html generated successfully. It can be s
